@{
    ViewData["Title"] = "Calendar";
}

<div class="calendar-container">
    <div class="calendar-header">
        <h2><i class="fas fa-calendar-alt"></i> Task Calendar</h2>
        <div class="calendar-actions">
            <button id="export-calendar" class="btn-export">
                <i class="fas fa-file-export"></i> Export
            </button>
        </div>
    </div>
    <div id="calendar"></div>
</div>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: '/api/todo/calendar',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                eventClassNames: function(arg) {
                    if (arg.event.extendedProps.category) {
                        return ['fc-event-' + arg.event.extendedProps.category.toLowerCase()];
                    }
                    return [];
                },
                eventContent: function(arg) {
                    let icon = '';
                    switch(arg.event.extendedProps.category?.toLowerCase()) {
                        case 'work': icon = 'üíº'; break;
                        case 'personal': icon = 'üè†'; break;
                        case 'shopping': icon = 'üõí'; break;
                        case 'urgent': icon = '‚ö†Ô∏è'; break;
                        case 'study': icon = 'üìö'; break;
                        default: icon = '‚úì';
                    }
                    
                    return {
                        html: `<div class="fc-event-content">
                               <span class="fc-event-title">${arg.event.extendedProps.user}</span>

                            <span class="fc-event-icon">${icon}</span>
                            <span class="fc-event-title">${arg.event.title}</span>

                        </div>`
                    };
                }
            });

            calendar.render();

            document.getElementById('export-calendar').addEventListener('click', function () {
            html2pdf()
                .set({
                    margin: 0.5,
                    filename: 'TodoList-Calendar.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'landscape' }
                })
                .from(document.getElementById('calendar'))
                .save();
        });
        });
    </script>
}